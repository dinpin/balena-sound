# Balena-sound specific PipeWire configuration
# This creates the virtual sinks for audio routing

context.objects = [
    # Create balena-sound.input sink (default sink for all plugins)
    {
        factory = adapter
        args = {
            factory.name = support.null-audio-sink
            node.name = "balena-sound.input"
            node.description = "Balena Sound Input"
            media.class = "Audio/Sink"
            audio.position = [ FL FR ]
            monitor.channel-volumes = true
            monitor.mute = false
            node.passive = false
            adapter.auto-port-config = {
                mode = dsp
                monitor = true
                position = preserve
            }
        }
    }
    
    # Create balena-sound.output sink (routes to actual hardware)
    {
        factory = adapter
        args = {
            factory.name = support.null-audio-sink
            node.name = "balena-sound.output"
            node.description = "Balena Sound Output"
            media.class = "Audio/Sink"
            audio.position = [ FL FR ]
            monitor.channel-volumes = true
            monitor.mute = false
            node.passive = false
            adapter.auto-port-config = {
                mode = dsp
                monitor = true
                position = preserve
            }
        }
    }
    
    # Create snapcast sink for multiroom
    {
        factory = adapter
        args = {
            factory.name = support.null-audio-sink
            node.name = "snapcast"
            node.description = "Snapcast Multiroom"
            media.class = "Audio/Sink"
            audio.position = [ FL FR ]
            monitor.channel-volumes = true
            monitor.mute = false
            node.passive = false
            adapter.auto-port-config = {
                mode = dsp
                monitor = true
                position = preserve
            }
        }
    }
    
    # Note: FIFO sink for snapcast will be created by multiroom-server if needed
]

# Linking rules for audio routing
context.exec = [
    # These will be created dynamically by the start.sh script based on MODE
]

# Set default sink
context.properties = {
    default.configured.audio.sink = "balena-sound.input"
}

# PulseAudio compatibility properties
pulse.properties = {
    pulse.default.sink = "balena-sound.input"
}
