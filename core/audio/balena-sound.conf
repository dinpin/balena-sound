# Balena-sound specific PipeWire configuration
# This creates the virtual sinks for audio routing

context.objects = [
    # Create balena-sound.input sink (default sink for all plugins)
    {
        factory = adapter
        args = {
            factory.name = support.null-audio-sink
            node.name = "balena-sound.input"
            node.description = "Balena Sound Input"
            media.class = "Audio/Sink"
            audio.position = [ FL FR ]
            monitor.channel-volumes = true
            monitor.mute = false
            node.passive = false
            adapter.auto-port-config = {
                mode = dsp
                monitor = true
                position = preserve
            }
        }
    }
    
    # Create balena-sound.output sink (routes to actual hardware)
    {
        factory = adapter
        args = {
            factory.name = support.null-audio-sink
            node.name = "balena-sound.output"
            node.description = "Balena Sound Output"
            media.class = "Audio/Sink"
            audio.position = [ FL FR ]
            monitor.channel-volumes = true
            monitor.mute = false
            node.passive = false
            adapter.auto-port-config = {
                mode = dsp
                monitor = true
                position = preserve
            }
        }
    }
    
    # Create snapcast sink for multiroom
    {
        factory = adapter
        args = {
            factory.name = support.null-audio-sink
            node.name = "snapcast"
            node.description = "Snapcast Multiroom"
            media.class = "Audio/Sink"
            audio.position = [ FL FR ]
            monitor.channel-volumes = true
            monitor.mute = false
            node.passive = false
            adapter.auto-port-config = {
                mode = dsp
                monitor = true
                position = preserve
            }
        }
    }
    
    # Create a FIFO sink for snapcast server
    {
        factory = adapter
        args = {
            factory.name = api.alsa.pcm.sink
            node.name = "snapcast-fifo"
            node.description = "Snapcast FIFO"
            media.class = "Audio/Sink"
            api.alsa.path = "/tmp/snapfifo"
            api.alsa.format = S16LE
            api.alsa.rate = 48000
            api.alsa.channels = 2
            api.alsa.period-size = 1024
            api.alsa.headroom = 0
            api.alsa.start-delay = 0
            audio.position = [ FL FR ]
            node.passive = false
        }
    }
]

# Linking rules for audio routing
context.exec = [
    # These will be created dynamically by the start.sh script based on MODE
]

# Set default sink
context.properties = {
    default.configured.audio.sink = "balena-sound.input"
}

# PulseAudio compatibility properties
pulse.properties = {
    pulse.default.sink = "balena-sound.input"
}
